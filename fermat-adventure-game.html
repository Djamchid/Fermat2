<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Qu√™te du Th√©or√®me de Fermat</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }

        .book-container {
            background: #f8f8f8;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin: 10px 0;
            width: 100%;
        }

        .chapter-header {
            text-align: center;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .chapter-header h1 {
            font-size: 1.5rem;
            margin: 0;
            line-height: 1.3;
        }

        .story-text {
            line-height: 1.7;
            font-size: 1rem;
            margin-bottom: 20px;
            text-align: justify;
            hyphens: auto;
        }

        .choices {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .choice-button {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-align: left;
            line-height: 1.4;
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .choice-button:active {
            transform: translateY(0);
        }

        .math-formula {
            background: #ecf0f1;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
            font-family: 'Times New Roman', serif;
            font-style: italic;
            text-align: center;
            font-size: 1rem;
            overflow-x: auto;
            white-space: nowrap;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .ending {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .ending h2 {
            margin-top: 0;
            font-size: 1.5rem;
        }

        .success {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .failure {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .restart-button {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 15px;
            transition: background 0.3s ease;
        }

        .restart-button:hover {
            background: #27ae60;
        }

        .year {
            font-size: 0.8rem;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 15px;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #7f8c8d;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        /* Tablettes */
        @media (max-width: 768px) {
            body {
                padding: 8px;
            }

            .book-container {
                padding: 15px;
                border-radius: 10px;
                margin: 8px 0;
            }

            .chapter-header h1 {
                font-size: 1.3rem;
            }

            .story-text {
                font-size: 0.95rem;
                text-align: left;
            }

            .choice-button {
                padding: 12px;
                font-size: 0.85rem;
                min-height: 55px;
            }

            .math-formula {
                padding: 12px;
                font-size: 0.9rem;
            }
        }

        /* Smartphones */
        @media (max-width: 480px) {
            body {
                padding: 5px;
                font-size: 14px;
            }

            .book-container {
                padding: 12px;
                border-radius: 8px;
                margin: 5px 0;
            }

            .chapter-header {
                padding-bottom: 10px;
                margin-bottom: 15px;
            }

            .chapter-header h1 {
                font-size: 1.2rem;
                line-height: 1.2;
            }

            .story-text {
                font-size: 0.9rem;
                line-height: 1.6;
                margin-bottom: 15px;
                text-align: left;
            }

            .choices {
                gap: 10px;
                margin-top: 15px;
            }

            .choice-button {
                padding: 10px;
                font-size: 0.8rem;
                min-height: 50px;
                border-radius: 6px;
            }

            .choice-button:hover {
                transform: none;
            }

            .math-formula {
                padding: 10px;
                font-size: 0.85rem;
                margin: 10px 0;
                border-left-width: 3px;
            }

            .progress-bar {
                height: 6px;
                margin: 10px 0;
            }

            .ending {
                padding: 15px;
                margin: 15px 0;
            }

            .ending h2 {
                font-size: 1.3rem;
            }

            .restart-button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            .year {
                font-size: 0.75rem;
            }
        }

        /* Tr√®s petits √©crans */
        @media (max-width: 320px) {
            .chapter-header h1 {
                font-size: 1.1rem;
            }

            .story-text {
                font-size: 0.85rem;
            }

            .choice-button {
                font-size: 0.75rem;
                padding: 8px;
                min-height: 45px;
            }

            .math-formula {
                font-size: 0.8rem;
                padding: 8px;
            }
        }

        /* Mode paysage sur mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .book-container {
                padding: 10px;
            }

            .chapter-header {
                margin-bottom: 10px;
            }

            .story-text {
                margin-bottom: 10px;
            }

            .choices {
                gap: 8px;
                margin-top: 10px;
            }

            .choice-button {
                min-height: 40px;
                padding: 8px;
            }
        }

        /* Am√©lioration de l'accessibilit√© */
        @media (prefers-reduced-motion: reduce) {
            .choice-button {
                transition: none;
            }

            .choice-button:hover {
                transform: none;
            }

            .progress-fill {
                transition: none;
            }
        }

        /* Mode sombre syst√®me */
        @media (prefers-color-scheme: dark) {
            .book-container {
                background: #2c3e50;
                color: #ecf0f1;
            }

            .chapter-header {
                color: #3498db;
            }

            .math-formula {
                background: #34495e;
                color: #ecf0f1;
            }
        }
    </style>
</head>
<body>
    <div class="book-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%"></div>
        </div>
        
        <div id="story-content">
            <div class="loading">Chargement du jeu...</div>
        </div>
    </div>

    <script>
        // Variable pour stocker les donn√©es du jeu
        let story = null;
        let currentNode = 'start';

        // Fonction pour charger les donn√©es du jeu
        async function loadStoryData() {
            try {
                // Dans un environnement r√©el, vous chargeriez depuis un fichier externe
                // Pour l'artifact, les donn√©es sont incluses directement
                story = await loadStoryFromFile();
                initGame();
            } catch (error) {
                document.getElementById('story-content').innerHTML = `
                    <div class="error">
                        <h2>Erreur de chargement</h2>
                        <p>Impossible de charger les donn√©es du jeu.</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Fonction pour m√©langer un tableau
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Fonction pour afficher un n≈ìud
        function displayNode(nodeId) {
            if (!story || !story[nodeId]) {
                console.error('N≈ìud non trouv√©:', nodeId);
                return;
            }

            const node = story[nodeId];
            const content = document.getElementById('story-content');
            const progress = document.getElementById('progress');
            
            progress.style.width = (node.progress || 0) + '%';
            
            if (node.ending) {
                // Fin du jeu
                content.innerHTML = `
                    <div class="chapter-header">
                        <h1>${node.title}</h1>
                        ${node.year ? `<div class="year">${node.year}</div>` : ''}
                    </div>
                    <div class="story-text">${node.text}</div>
                    ${node.formula ? `<div class="math-formula">${node.formula}</div>` : ''}
                    <div class="ending ${node.ending}">
                        <h2>${node.ending === 'success' ? 'üéâ VICTOIRE ! üéâ' : 'üí• √âCHEC üí•'}</h2>
                        <p>${node.ending === 'success' ? 'Vous avez r√©ussi √† reconstituer la preuve historique !' : 'Ce chemin ne m√®ne pas √† la solution...'}</p>
                        <button class="restart-button" onclick="restart()">Recommencer l'aventure</button>
                    </div>
                `;
            } else if (node.choices) {
                // M√©langer les choix al√©atoirement
                const shuffledChoices = shuffleArray(node.choices);
                const letters = ['A', 'B', 'C', 'D'];
                
                // N≈ìud normal avec choix
                content.innerHTML = `
                    <div class="chapter-header">
                        <h1>${node.title}</h1>
                        ${node.year ? `<div class="year">${node.year}</div>` : ''}
                    </div>
                    <div class="story-text">${node.text}</div>
                    ${node.formula ? `<div class="math-formula">${node.formula}</div>` : ''}
                    <div class="choices">
                        ${shuffledChoices.map((choice, index) => {
                            // Remplacer la lettre originale par la nouvelle position
                            const newText = choice.text.replace(/^[A-D]\./, `${letters[index]}.`);
                            return `<button class="choice-button" onclick="makeChoice('${choice.next}')">${newText}</button>`;
                        }).join('')}
                    </div>
                `;
            } else {
                // N≈ìud sans choix (ne devrait pas arriver)
                content.innerHTML = `
                    <div class="chapter-header">
                        <h1>${node.title}</h1>
                        ${node.year ? `<div class="year">${node.year}</div>` : ''}
                    </div>
                    <div class="story-text">${node.text}</div>
                    ${node.formula ? `<div class="math-formula">${node.formula}</div>` : ''}
                `;
            }
        }

        // Fonction pour faire un choix
        function makeChoice(nextNode) {
            currentNode = nextNode;
            displayNode(currentNode);
        }

        // Fonction pour recommencer
        function restart() {
            currentNode = 'start';
            displayNode(currentNode);
        }

        // Initialiser le jeu
        function initGame() {
            displayNode(currentNode);
        }

        // Fonction temporaire pour charger les donn√©es
        // Dans un vrai projet, cela chargerait depuis un fichier externe
        async function loadStoryFromFile() {
            // Pour l'artifact, nous incluons une version minimale des donn√©es
            // Dans un environnement r√©el, vous utiliseriez :
            // const response = await fetch('story.js');
            // return await response.json();
            
            return {
                start: {
                    title: "Prologue : Le D√©fi de Fermat",
                    year: "1637 - Toulouse, France",
                    text: `Vous √™tes Pierre de Fermat, magistrat et math√©maticien amateur. En lisant l'Arithm√©tique de Diophante, vous venez de d√©couvrir une propri√©t√© fascinante des nombres. Dans la marge de votre livre, vous griffonnez une note qui hantera les math√©maticiens pendant plus de 350 ans.`,
                    formula: "x<sup>n</sup> + y<sup>n</sup> = z<sup>n</sup> n'a pas de solutions enti√®res pour n > 2",
                    choices: [
                        { text: "A. Vous √©crivez : 'J'ai d√©couvert une d√©monstration merveilleuse, mais cette marge est trop √©troite pour la contenir'", next: "fermat_claim" },
                        { text: "B. Vous tentez imm√©diatement de d√©montrer le th√©or√®me par la m√©thode de descente infinie", next: "demo_failure" },
                        { text: "C. Vous cherchez des contre-exemples pour v√©rifier votre intuition", next: "demo_failure" },
                        { text: "D. Vous abandonnez, pensant que c'est trop difficile", next: "demo_failure" }
                    ],
                    progress: 10
                },
                fermat_claim: {
                    title: "Chapitre 1 : L'H√©ritage d'un Myst√®re",
                    year: "1995 - Princeton, √âtats-Unis",
                    text: `Vous √™tes maintenant Andrew Wiles. Le chemin sera long mais vous r√©ussirez ! (Version de d√©mo - donn√©es compl√®tes dans story.js)`,
                    formula: "Il faut une approche r√©volutionnaire...",
                    ending: "success",
                    progress: 100
                },
                demo_failure: {
                    title: "Impasse de D√©monstration",
                    text: `Cette approche ne fonctionne pas. Le vrai chemin n√©cessite les outils du 20√®me si√®cle ! (Version de d√©mo - chargez story.js pour le jeu complet)`,
                    ending: "failure",
                    progress: 25
                }
            };
        }

        // Charger le jeu au d√©marrage
        loadStoryData();
    </script>
</body>
</html>